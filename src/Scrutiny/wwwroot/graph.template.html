<!DOCTYPE html>
<html>

<head>
    <title></title>
    <style>
        /* This sets the color for "TK" nodes to a light blue green. */
        g.type-TK>rect {
            fill: #00ffd0;
        }

        text {
            font-weight: 300;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: 14px;
        }

    </style>
</head>

<body>

    <pre id="graph" class="mermaid"></pre>

</body>
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.esm.min.mjs';

    const scrutinizedStates = "{{REPORT}}";

    const toId = name => name.replace(/\s/g, '').toLowerCase()

    const names =
        scrutinizedStates.graph.map((ps) => {
            const name = ps.from.name
            return `    ${toId(name)}: ${name}`
        }).join('\n');

    const graph =
        scrutinizedStates.graph.map((ps) => {
            const id = toId(ps.from.name);
            return ps.destinations.map(d => `    ${id} --> ${toId(d.name)}`).join('\n');
        }).join('\n');

    const graphElement = document.getElementById('graph');

    graphElement.innerHTML =
        `
stateDiagram
    direction LR

${names}

    accTitle: This is the accessible title
    accDescr: This is an accessible description

    classDef notMoving fill:white
    classDef movement font-style:italic;
    classDef badBadEvent fill:#f00,color:white,font-weight:bold,stroke-width:2px,stroke:yellow

${graph}
`
    console.log(graphElement.innerHTML)

    mermaid.initialize({ startOnLoad: true });
</script>

</html>
